<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>WWPM - Dashboard</title>

  <link href="../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="../../vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
  <link href="../../css/sb-admin.css" rel="stylesheet">

</head>

<body id="page-top">
  <nav id="nav-top" class="navbar navbar-expand navbar-dark bg-dark static-top"></nav>
  <div id="wrapper">
    <ul id="nav-menu" class="sidebar navbar-nav"></ul>

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <!-- <ol class="breadcrumb">
          <li class="breadcrumb-item">
            Plan List
          </li>
          <li class="breadcrumb-item active">
            <a href="../new/">New Plan</a>
          </li>
        </ol> -->

        <!-- /////////////////////////////////[Code]///////////////////////////////////////////////// -->
        <div class="card mb-3">
          <div class="card-header">
            <i class="fas fa-table"></i>
            PM List
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-bordered" id="listTable" width="100%" cellspacing="0">
                <thead>
                  <tr>
                    <th>Plan </th>
                    <th>Start Date</th>
                    <th>Expire Date</th>
                  </tr>
                </thead>
                <tbody id="tablebody">

                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
      <!-- /.container-fluid -->

      <!-- Sticky Footer -->
      <footer id="footer" class="sticky-footer" />

    </div>
    <!-- /.content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <div id="ex-event" />

  <script src="../../vendor/jquery/jquery.min.js"></script>
  <script src="../../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <script src="../../vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Page level plugin JavaScript-->
  <!-- <script src="../vendor/chart.js/Chart.min.js"></script> -->
  <script src="../../vendor/datatables/jquery.dataTables.js"></script>
  <script src="../../vendor/datatables/dataTables.bootstrap4.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="../../js/sb-admin.min.js"></script>

  <!-- Demo scripts for this page-->
  <!-- <script src="../js/demo/datatables-demo.js"></script> -->
  <!-- <script src="../js/demo/chart-area-demo.js"></script> -->

  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-database.js"></script>
  <script src="../../firebase/init.js"></script>
  <script src="../../js/route.js"></script>
  <script>
    // Call the dataTables jQuery plugin

  </script>

  <script>
    var dbRef = firebase.database().ref("PMplan");
    dbRef.on('value', function (snapshot) {

      snapshot.forEach(function (childSnapshot) {
        var childKey = childSnapshot.key;
        var childData = childSnapshot.val();
        console.log(childKey);
        // console.log(childData);

        //   var leadsRef = firebase.database().ref(`PMplan/${childKey}`);
        //   leadsRef.on('value', function (snapshot) {
        //     var useJson = snapshot.val().JSON;
        //     var obj = JSON.parse(useJson);
        //     $("#tablebody").html("")

        //     var subtext = "";
        //     obj.forEach((el, i) => {
        //       console.log(el);

        //       subtext += `<tr>
        //   <td>${el.Station}</td>
        //   <td><a href = "#" target="_blank">${el.TaskList}</a></td>
        //   <td>${el.Period} : ${childData.Start} - ${childData.Expire}</td>
        // </tr>`;
        //     })
        //     $("#tablebody").html(subtext)
        //     $('#listTable').DataTable();

        //   });

        $("#tablebody").append(`<tr>
          <td><a onclick="senddata(this)" data-set="${childSnapshot.key}" plan-name="${childData.Plan}" href="#">${childData.Plan}</a></td>
          <td>${childData.Start}</td>
          <td>${childData.Expire}</td>         
        </tr>`)
        // senddata(childKey);
      });
      $('#listTable').DataTable();
    });

    function senddata(e) {
      var id = $(e).attr('data-set');
      var planname = $(e).attr('plan-name');
      console.log(id);
      console.log(planname);

      var queryString = "?" + id + "&" + planname;
      window.location.href = "detail.html" + queryString;
    }


  </script>

  <!-- <script>
    setTimeout(function () {
      window.location.reload(1);
    }, 60000);
  </script> -->

</body>

</html>